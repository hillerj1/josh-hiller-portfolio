---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map((p) => ({
    params: { slug: p.slug },
    props: { project: p as CollectionEntry<'projects'> },
  }));
}

const { project } = Astro.props as { project: CollectionEntry<'projects'> };
const { Content } = await project.render();
const d = project.data;
---

<Layout title={`${d.title} — Josh Hiller`} description={d.summary} image={d.image}>
  <main class="container pad-y-xl">
    <p class="mb-sm"><a href="/projects" class="link">← Back to Projects</a></p>

    <img src={d.image} alt={d.title} class="hero-img" />
    <h1 class="h1 mt-sm">{d.title}</h1>
    <div class="muted mb-xs">{d.category}</div>
    <p class="lead">{d.summary}</p>

    <ul class="tag-list">
      {d.techstack.map((t) => <li class="tag">{t}</li>)}
    </ul>

    <div class="btn-row">
      <a href={d.github} target="_blank" rel="noopener noreferrer" class="btn btn-dark">GitHub Repo</a>
      {d.demo && d.demo.length > 0 ? (
        <a href={d.demo} target="_blank" rel="noopener noreferrer" class="btn btn-primary">Live Demo / Paper / Video</a>
      ) : null}
    </div>

    <article class="card">
      <h2>Problem</h2>
      <p>{d.problem}</p>
      <h2>Solution</h2>
      <p>{d.solution}</p>

      <section class="mt-md">
        <Content />
      </section>
    </article>
  </main>
</Layout>
